<div class="container">
  <div class="header">
    <h2>{{ isEditMode ? 'Edit Event' : 'Create New Event' }}</h2>
    <button class="btn btn-secondary" (click)="goBack()">Back to Events</button>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert success">
    {{ successMessage }}
  </div>
  
  <div *ngIf="error" class="alert error">
    {{ error }}
  </div>

  <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" class="form">
    <div class="form-group">
      <label for="title">Event Title *</label>
      <input type="text" id="title" formControlName="title" class="form-control">
      <div *ngIf="eventForm.get('title')?.invalid && eventForm.get('title')?.touched" class="error-text">
        Title is required (min 3 characters)
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" formControlName="description" class="form-control" rows="4"></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="start_date">Start Date *</label>
        <input type="datetime-local" id="start_date" formControlName="start_date" class="form-control">
        <div *ngIf="eventForm.get('start_date')?.invalid && eventForm.get('start_date')?.touched" class="error-text">
          Start date is required
        </div>
      </div>

      <div class="form-group">
        <label for="end_date">End Date *</label>
        <input type="datetime-local" id="end_date" formControlName="end_date" class="form-control">
        <div *ngIf="eventForm.get('end_date')?.invalid && eventForm.get('end_date')?.touched" class="error-text">
          End date is required
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="location">Location *</label>
      <input type="text" id="location" formControlName="location" class="form-control">
      <div *ngIf="eventForm.get('location')?.invalid && eventForm.get('location')?.touched" class="error-text">
        Location is required
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="category_id">Category ID *</label>
        <input type="number" id="category_id" formControlName="category_id" class="form-control" min="1">
        <div *ngIf="eventForm.get('category_id')?.invalid && eventForm.get('category_id')?.touched" class="error-text">
          Valid category ID is required
        </div>
      </div>

      <div class="form-group">
        <label for="max_tickets">Max Tickets *</label>
        <input type="number" id="max_tickets" formControlName="max_tickets" class="form-control" min="1">
        <div *ngIf="eventForm.get('max_tickets')?.invalid && eventForm.get('max_tickets')?.touched" class="error-text">
          Minimum 1 ticket required
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="goBack()">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="eventForm.invalid || loading">
        {{ loading ? 'Saving...' : (isEditMode ? 'Update Event' : 'Create Event') }}
      </button>
    </div>
  </form>

  <!-- Registration Info for Edit Mode -->
  <div *ngIf="isEditMode && registrations.length > 0" class="registrations">
    <h3>Event Registrations</h3>
    <div class="stats">
      <div class="stat">
        <strong>{{ registrations.length }}</strong> Total Registrations
      </div>
      <div class="stat">
        <strong>{{ getTotalTickets() }}</strong> Tickets Booked
      </div>
    </div>
    
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Tickets</th>
          <th>Registration Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reg of registrations">
          <td>{{ reg.user_name }}</td>
          <td>{{ reg.user_email }}</td>
          <td>{{ reg.ticket_count }}</td>
          <td>{{ reg.registration_date | date:'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>