<div class="container">
  <div class="event-detail">
    <div *ngIf="loading" id="loading">Loading event details...</div>
    <div *ngIf="error" id="error" style="color: red; text-align: center;">{{error}}</div>
    
    <div *ngIf="!loading && !error && event" class="event-detail-content">
      <div class="event-detail-header">
        <h1>{{event.title}}</h1>
        <div class="meta">
          <p><strong>Category:</strong> {{event.category_name}}</p>
          <p><strong>Date:</strong> {{formatDate(event.event_date)}}</p>
          <p><strong>Location:</strong> {{event.location}}</p>
        </div>
      </div>

      <img [src]="event.image_url" [alt]="event.title" class="event-detail-img">

      <div class="event-description">
        <h3>About This Event</h3>
        <p>{{event.full_description}}</p>
      </div>

      <!-- 天气信息 -->
      <div *ngIf="weather" class="ticket-info">
        <h3>Weather Forecast</h3>
        <div *ngIf="weather.daily">
          <p><strong>Today:</strong> {{getWeatherDescription(weather.daily.weather_code[0])}}</p>
          <p><strong>Max Temp:</strong> {{weather.daily.temperature_2m_max[0]}}°C</p>
          <p><strong>Min Temp:</strong> {{weather.daily.temperature_2m_min[0]}}°C</p>
        </div>
      </div>

      <div class="ticket-info">
        <h3>Ticket Information</h3>
        <p>Ticket Price: <span [innerHTML]="formatPrice(event.ticket_price)"></span></p>
        <button (click)="goToRegister()" class="btn btn-primary" style="margin-top: 1rem;">
          Register Now
        </button>
      </div>

      <!-- 注册记录 -->
      <div *ngIf="registrations.length > 0" class="progress-section">
        <h3>Recent Registrations</h3>
        <div style="background: white; padding: 1rem; border-radius: 8px;">
          <div *ngFor="let registration of registrations | slice:0:5" 
               style="padding: 0.5rem 0; border-bottom: 1px solid #eee;">
            <strong>{{registration.user_name}}</strong> - 
            {{registration.ticket_quantity}} ticket(s) - 
            {{formatDate(registration.registration_date)}}
          </div>
        </div>
      </div>

      <div class="progress-section">
        <h3>Fundraising Progress</h3>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercent"></div>
        </div>
        <div class="progress-text">
          <span>Raised: ${{(event.current_amount || 0).toFixed(2)}}</span>
          <span>Goal: ${{(event.goal_amount || 0).toFixed(2)}} ({{progressPercent}}%)</span>
        </div>
      </div>
    </div>
  </div>
</div>